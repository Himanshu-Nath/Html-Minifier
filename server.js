var express=require('express');
var bodyParser = require('body-parser');
var minify = require('html-minifier').minify;
//var beautify = require('html-beautify');
//var beautify = require('js-beautify').js_beautify;
var beautify = require('beautify');
var app=express();
var port_no = 3000;

app.use(bodyParser.json() );       // to support JSON-encoded bodies
app.use(bodyParser.urlencoded({     // to support URL-encoded bodies
  extended: true
}));

app.use(express.static(__dirname + '/static'));

app.get('/',function(req,res){
	res.sendFile( __dirname + "/" + 'index.html');
});

app.post('/compress',function(req,res){
	
	var content = req.body.data;
	var result = minify(content, {
		collapseWhitespace : true,
		removeComments: true,
		removeEmptyAttributes: true,
		removeEmptyElements: true,
		removeRedundantAttributes: true,
		sortAttributes: true,
		sortClassName: true,
		removeComments: true,
		minifyCSS: true,
		minifyJS: true,
		caseSensitive: true,
		collapseInlineTagWhitespace: true,
		keepClosingSlash: true,
		includeAutoGeneratedTags: true
	});		
	var response = {};
	response.status = true;
	response.data = result;
	res.send(response);
});

app.post('/uncompress',function(req,res){
	var response = {};
	var content = req.body.data;
	var type = req.body.type;
	console.log(type);
//	response.data = htmlBeautify(content, { indent_size: 4, eval_code: false,
//    response.data = beautify(content, { indent_size: 4, eval_code: false,
    response.data = beautify(content, {format: type});	
	response.status = true;
	res.send(response);
});

app.listen(port_no, function(){
	console.log("Express Started on Port "+port_no);
});